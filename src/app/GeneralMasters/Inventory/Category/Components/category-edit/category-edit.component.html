<!-- Contenedor Principal con la fuente y fondo estandarizados -->
<div class="flex w-full h-full" style="font-family: var(--font-family-titillium);">
  <!-- Tarjeta de Contenido Principal, aplicando el estilo de la guía -->
  <div class="m-4 md:m-10 w-full font-medium rounded-2xl md:rounded-3xl p-6 md:p-10" style="background-color: var(--color-primary-100);">

    <!-- 1. CABECERA: Título y Botón de Regreso -->
    <div class="flex justify-between items-start mb-12">
      <!-- Título con el estilo de marca -->
      <div class="items-center">
        <h1 class="font-bold text-3xl/41 inline-block pb-1" style="font-family: var(--font-family-titillium); color: var(--color-primary); border-bottom: 4px solid var(--color-secondary);">
          Editar Categoría
        </h1>
        <p class="font-normal text-sm mt-2" style="font-family: var(--font-family-sans);">
          Modifique la información de la categoría en el sistema.
        </p>
      </div>

      <!-- Botón de Regreso -->
      <div class="hidden sm:block">
        <p-button icon="pi pi-arrow-left" (click)="goBack()" pTooltip="Regresar a la lista"
          styleClass="p-button-text p-button-secondary"></p-button>
      </div>
    </div>

    <!-- 2. FORMULARIO DE EDICIÓN DE CATEGORÍA -->
    <form [formGroup]="editForm" (ngSubmit)="onSubmit()" *ngIf="!loading">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-5" style="font-family: var(--font-family-sans);">

        <!-- Nombre de la Categoría -->
        <div class="flex flex-col gap-2">
          <label for="name" class="font-semibold" style="color: var(--color-primary);">Nombre de la Categoría <span class="text-red-500">*</span></label>
          <input pInputText id="name" formControlName="name" placeholder="Ej: Electrónicos, Ropa, Alimentos"
            class="w-full md:w-2/3" />
          @if (editForm.get('name')?.invalid && editForm.get('name')?.touched) {
          <small style="color: var(--color-error-35);">El nombre es requerido.</small>
          }
        </div>

        <!-- Descripción -->
        <div class="flex flex-col gap-2">
          <label for="description" class="font-semibold" style="color: var(--color-primary);">Descripción <span class="text-red-500">*</span></label>
          <input pInputText id="description" formControlName="description" 
            placeholder="Descripción de la categoría"
            class="w-full md:w-2/3" />
          @if (editForm.get('description')?.invalid && editForm.get('description')?.touched) {
          <small style="color: var(--color-error-35);">La descripción es requerida.</small>
          }
        </div>

        <!-- Cuenta de Inventario -->
        <div class="flex flex-col gap-2">
          <label for="inventory" class="font-semibold" style="color: var(--color-primary);">Cuenta de Inventario <span class="text-red-500">*</span></label>
          <p-select
            id="inventory"
            formControlName="inventory"
            [options]="inventory"
            optionLabel="description"
            placeholder="Seleccione una cuenta"
            [filter]="true"
            filterBy="code,description"
            [showClear]="true"
            class="w-full md:w-2/3"
          >
            <ng-template pTemplate="selectedItem" let-selectedOption>
              <div *ngIf="selectedOption">
                {{ selectedOption.code }} - {{ selectedOption.description }}
              </div>
            </ng-template>
            <ng-template pTemplate="item" let-option>
              <div>{{ option.code }} - {{ option.description }}</div>
            </ng-template>
          </p-select>
          @if (editForm.get('inventory')?.invalid && editForm.get('inventory')?.touched) {
          <small style="color: var(--color-error-35);">Debe seleccionar una cuenta de inventario.</small>
          }
        </div>

        <!-- Cuenta de Costo -->
        <div class="flex flex-col gap-2">
          <label for="cost" class="font-semibold" style="color: var(--color-primary);">Cuenta de Costo <span class="text-red-500">*</span></label>
          <p-select
            id="cost"
            formControlName="cost"
            [options]="cost"
            optionLabel="description"
            placeholder="Seleccione una cuenta"
            [filter]="true"
            filterBy="code,description"
            [showClear]="true"
            class="w-full md:w-2/3"
          >
            <ng-template pTemplate="selectedItem" let-selectedOption>
              <div *ngIf="selectedOption">
                {{ selectedOption.code }} - {{ selectedOption.description }}
              </div>
            </ng-template>
            <ng-template pTemplate="item" let-option>
              <div>{{ option.code }} - {{ option.description }}</div>
            </ng-template>
          </p-select>
          @if (editForm.get('cost')?.invalid && editForm.get('cost')?.touched) {
          <small style="color: var(--color-error-35);">Debe seleccionar una cuenta de costo.</small>
          }
        </div>

        <!-- Cuenta de Venta -->
        <div class="flex flex-col gap-2">
          <label for="sale" class="font-semibold" style="color: var(--color-primary);">Cuenta de Venta <span class="text-red-500">*</span></label>
          <p-select
            id="sale"
            formControlName="sale"
            [options]="sale"
            optionLabel="description"
            placeholder="Seleccione una cuenta"
            [filter]="true"
            filterBy="code,description"
            [showClear]="true"
            class="w-full md:w-2/3"
          >
            <ng-template pTemplate="selectedItem" let-selectedOption>
              <div *ngIf="selectedOption">
                {{ selectedOption.code }} - {{ selectedOption.description }}
              </div>
            </ng-template>
            <ng-template pTemplate="item" let-option>
              <div>{{ option.code }} - {{ option.description }}</div>
            </ng-template>
          </p-select>
          @if (editForm.get('sale')?.invalid && editForm.get('sale')?.touched) {
          <small style="color: var(--color-error-35);">Debe seleccionar una cuenta de venta.</small>
          }
        </div>

        <!-- Cuenta de Devolución -->
        <div class="flex flex-col gap-2">
          <label for="return" class="font-semibold" style="color: var(--color-primary);">Cuenta de Devolución <span class="text-red-500">*</span></label>
          <p-select
            id="return"
            formControlName="return"
            [options]="return"
            optionLabel="description"
            placeholder="Seleccione una cuenta"
            [filter]="true"
            filterBy="code,description"
            [showClear]="true"
            class="w-full md:w-2/3"
          >
            <ng-template pTemplate="selectedItem" let-selectedOption>
              <div *ngIf="selectedOption">
                {{ selectedOption.code }} - {{ selectedOption.description }}
              </div>
            </ng-template>
            <ng-template pTemplate="item" let-option>
              <div>{{ option.code }} - {{ option.description }}</div>
            </ng-template>
          </p-select>
          @if (editForm.get('return')?.invalid && editForm.get('return')?.touched) {
          <small style="color: var(--color-error-35);">Debe seleccionar una cuenta de devolución.</small>
          }
        </div>

      </div>

      <!-- 3. BOTONES DE ACCIÓN -->
      <div class="flex justify-end gap-4 mt-12 pt-40">
        <p-button 
          type="button"
          label="Cancelar" 
          severity="secondary"
          (onClick)="goBack()">
        </p-button>
                 <p-button 
           type="submit"
           label="Guardar Cambios"
           [disabled]="editForm.invalid || !hasChanges()">
         </p-button>
      </div>
    </form>

    <!-- Loading state -->
    <div *ngIf="loading" class="flex justify-center items-center h-64">
      <i class="pi pi-spin pi-spinner text-4xl" style="color: var(--color-primary);"></i>
    </div>

  </div>
</div>
